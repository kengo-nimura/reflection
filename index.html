<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>ãƒ¢ãƒ³ã‚¹ãƒˆåå°„ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: sans-serif; }
        canvas { display: block; z-index: 1; position: absolute; top: 0; left: 0; }
        #ui { position: absolute; bottom: 10px; left: 10px; z-index: 10; display: flex; gap: 10px; }
        .btn { background: rgba(255,255,255,0.2); color: white; border: 1px solid white; padding: 5px 10px; border-radius: 5px; font-size: 12px; }
        input[type="file"] { display: none; }
    </style>
</head>
<body>

<div id="ui">
    <label class="btn">ğŸ“· ã‚¹ã‚¯ã‚·ãƒ§é¸æŠ <input type="file" id="bgInput" accept="image/*"></label>
    <div class="btn" id="refCountBtn">åå°„: 5å›</div>
</div>
<canvas id="gameCanvas"></canvas>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const bgInput = document.getElementById('bgInput');
const refCountBtn = document.getElementById('refCountBtn');

let bgImage = null;
let maxReflections = 5;

// ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ï¼ˆèµ¤ã„å††ï¼‰
const ball = { x: 200, y: 400, radius: 20, angle: -Math.PI/4 };
let isDraggingBall = false;
let isAdjustingAngle = false;

function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

// ã‚¹ã‚¯ã‚·ãƒ§èª­ã¿è¾¼ã¿å‡¦ç†
bgInput.onchange = (e) => {
    const file = e.target.files[0];
    const reader = new FileReader();
    reader.onload = (event) => {
        const img = new Image();
        img.onload = () => { bgImage = img; };
        img.src = event.target.result;
    };
    reader.readAsDataURL(file);
};

// åå°„æ•°åˆ‡ã‚Šæ›¿ãˆ
refCountBtn.onclick = () => {
    maxReflections = maxReflections >= 10 ? 1 : maxReflections + 1;
    refCountBtn.innerText = `åå°„: ${maxReflections}å›`;
};

// æ“ä½œç³»
canvas.addEventListener('touchstart', handleStart);
canvas.addEventListener('touchmove', handleMove);
canvas.addEventListener('touchend', () => { isDraggingBall = false; isAdjustingAngle = false; });

function handleStart(e) {
    const t = e.touches[0];
    const dist = Math.hypot(t.clientX - ball.x, t.clientY - ball.y);
    if (dist < ball.radius * 2) {
        isDraggingBall = true;
    } else {
        isAdjustingAngle = true;
        updateAngle(t.clientX, t.clientY);
    }
}

function handleMove(e) {
    const t = e.touches[0];
    if (isDraggingBall) {
        ball.x = t.clientX;
        ball.y = t.clientY;
    } else if (isAdjustingAngle) {
        updateAngle(t.clientX, t.clientY);
    }
    e.preventDefault();
}

function updateAngle(tx, ty) {
    ball.angle = Math.atan2(ty - ball.y, tx - ball.x);
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // 1. èƒŒæ™¯ï¼ˆã‚¹ã‚¯ã‚·ãƒ§ï¼‰æç”»
    if (bgImage) {
        const scale = Math.min(canvas.width / bgImage.width, canvas.height / bgImage.height);
        ctx.drawImage(bgImage, 0, 0, bgImage.width * scale, bgImage.height * scale);
    }

    //
